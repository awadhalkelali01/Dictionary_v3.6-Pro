<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨</title>

<link rel="stylesheet" href="styles.css">
<script src="modals.js" defer></script>

<style>
.header-title {
  text-align:center; 
  font-size:1.45rem; 
  font-weight:800; 
  margin:0;
}
.actions {
  text-align:center;
  margin: 18px 0;
  display:flex;
  justify-content:center;
  gap:12px;
  flex-wrap:wrap;
}
</style>
</head>
<body>

<header class="app-header">
  <div></div>
  <div><h1 class="header-title">ğŸ‘¨â€ğŸ« Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨</h1></div>
  <div><button class="icon-btn" onclick="location.href='index.html'">ğŸ </button></div>
</header>

<main class="container">

  <div class="actions">
    <button class="btn btn-main" id="btnAddClass">â• Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
    <button class="btn btn-secondary" id="btnAddStudent">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
  </div>

  <div id="classList"></div>

</main>

<footer class="app-footer">
  â¤ï¸â¤ï¸ ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ°: <b>Ø£Ø¨Ùˆ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡</b> â€” Ù‡Ø¯ÙŠØ© Ù…Ù† Ø£Ø¨ Ù„Ø£Ø¨Ù†Ø§Ø¦Ù‡ â¤ï¸â¤ï¸
</footer>

<!-- Modal system -->
<div id="sharedModalBackdrop" style="display:none;align-items:center;justify-content:center;">
  <div id="sharedModal"></div>
</div>
<div id="toast"></div>

<script>
// ===============================
// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
// ===============================
document.body.classList.add(localStorage.getItem("theme") || "theme-blue");

// ===============================
// Ø¬Ù„Ø¨ ÙˆØªØ®Ø²ÙŠÙ† Ø§Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨
// ===============================
let classes = JSON.parse(localStorage.getItem("classes") || "{}");

function saveClasses() {
  localStorage.setItem("classes", JSON.stringify(classes));
}

// ===============================
// Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
// ===============================
function render() {
  const root = document.getElementById("classList");
  let html = "";

  Object.keys(classes).forEach(cls => {
    html += `
      <div class="info-card" style="margin-bottom:18px;">
        <h3 style="margin:0;color:var(--primary);font-weight:800;">${cls}</h3>
    `;

    classes[cls].forEach((student, i) => {
      html += `
        <div class="student-item">
          <div style="font-weight:700;">${student}</div>
          <div class="student-buttons">
            <button class="icon-btn" onclick="openDictionary('${cls}','${student}')">ğŸ“˜</button>
            <button class="icon-btn" onclick="editStudent('${cls}', ${i})">âœï¸</button>
            <button class="icon-btn" onclick="deleteStudent('${cls}', ${i})">âŒ</button>
          </div>
        </div>
      `;
    });

    html += `</div>`;
  });

  root.innerHTML = html || `<div class="info-card-empty">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙÙˆÙ Ø¨Ø¹Ø¯</div>`;
}

// ===============================
// Ø¥Ø¶Ø§ÙØ© ØµÙ
// ===============================
btnAddClass.onclick = function () {
  showPrompt("Ø¥Ø¶Ø§ÙØ© ØµÙ", "Ø§Ø³Ù… Ø§Ù„ØµÙ", "Ù…Ø«Ø§Ù„: Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³", "", val => {
    if(!val.trim()) return;
    if(!classes[val]) classes[val] = [];
    saveClasses();
    render();
    showToast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ");
  });
};

// ===============================
// Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨
// ===============================
btnAddStudent.onclick = function () {
  const classNames = Object.keys(classes);
  if(classNames.length === 0) {
    showToast("Ø£Ø¶Ù ØµÙÙ‹Ø§ Ø£ÙˆÙ„Ø§Ù‹", "warn");
    return;
  }

  showModalForm("Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨", [
    {
      name:"cls",
      label:"Ø§Ø®ØªØ± Ø§Ù„ØµÙ",
      type:"select",
      options: classNames.map(c => ({value:c, text:c}))
    },
    {
      name:"name",
      label:"Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨",
      type:"text",
      value:""
    }
  ], vals => {
    const cls = vals.cls;
    const name = vals.name.trim();
    if(!name) return;
    classes[cls].push(name);
    saveClasses();
    render();
    showToast("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨");
  });
};

// ===============================
// ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨
// ===============================
function editStudent(cls, i) {
  const current = classes[cls][i];
  showPrompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨", "Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯", "", current, val => {
    if(!val.trim()) return;
    classes[cls][i] = val.trim();
    saveClasses();
    render();
    showToast("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„");
  });
}

// ===============================
// Ø­Ø°Ù Ø·Ø§Ù„Ø¨
// ===============================
function deleteStudent(cls, i) {
  showConfirm("Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨", "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ", () => {
    classes[cls].splice(i,1);
    saveClasses();
    render();
    showToast("ØªÙ… Ø§Ù„Ø­Ø°Ù");
  });
}

// ===============================
// ÙØªØ­ Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
// ===============================
function openDictionary(cls, student) {
  localStorage.setItem("className", cls);
  localStorage.setItem("studentName", student);
  location.href = "dictionary.html";
}

// ===============================
render();
</script>

</body>
</html>
